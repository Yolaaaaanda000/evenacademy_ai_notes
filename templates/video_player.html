<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频学习平台 - 知识点标签</title>
    <link rel="stylesheet" href="/static/style_video_player.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎥 视频学习平台</h1>
            <p>智能识别知识点，实时同步时间戳</p>
            <nav class="main-nav">
                <a href="/" class="nav-link active">🎬 视频学习</a>
            </nav>
        </header>
        
        <main>
            <!-- 视频上传区域 -->
            <div id="upload-section" class="upload-section">
                <div class="upload-container">
                    <h2>📁 上传视频文件</h2>
                    <div class="upload-area">
                        <label for="video-file" class="upload-label">
                            <div class="upload-icon">📁</div>
                            <span>点击选择视频文件</span>
                            <small>支持 MP4, MOV, AVI, MKV 格式</small>
                        </label>
                        <input type="file" id="video-file" name="video_file" accept=".mp4,.mov,.avi,.mkv" hidden>
                    </div>
                    
                    <div class="video-info" id="video-info" style="display: none;">
                        <div class="info-item">
                            <label for="video-title">视频标题:</label>
                            <input type="text" id="video-title" name="title" placeholder="例如: 数学课程 - 线性代数基础">
                        </div>
                        <div class="info-item">
                            <label for="video-language">输出语言:</label>
                            <select id="video-language" name="language">
                                <option value="中文" selected>中文</option>
                                <option value="English">English</option>
                            </select>
                        </div>
                        <button id="process-video-btn" class="primary-btn">🚀 开始分析视频</button>
                    </div>
                </div>
                
                <div id="processing-status" class="processing-status" style="display: none;">
                    <div class="processing-header">
                        <h3 class="processing-title">🎬 正在分析视频内容</h3>
                        <p class="processing-subtitle">AI正在智能识别视频中的知识点，请稍候...</p>
                    </div>
                    
                    <div class="processing-animation">
                        <div class="loader"></div>
                        <div class="processing-dots">
                            <div class="processing-dot"></div>
                            <div class="processing-dot"></div>
                            <div class="processing-dot"></div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    
                    <div class="processing-steps" id="processing-steps">
                        <div class="processing-step" data-step="transcribe">
                            <div class="step-icon pending">1</div>
                            <div class="step-content">
                                <div class="step-title">语音转录</div>
                                <div class="step-description">正在将视频音频转换为文字...</div>
                            </div>
                        </div>
                        <div class="processing-step" data-step="analyze">
                            <div class="step-icon pending">2</div>
                            <div class="step-content">
                                <div class="step-title">内容分析</div>
                                <div class="step-description">AI正在识别重要知识点和内容片段...</div>
                            </div>
                        </div>
                        <div class="processing-step" data-step="timestamp">
                            <div class="step-icon pending">3</div>
                            <div class="step-content">
                                <div class="step-title">精确匹配时间戳</div>
                                <div class="step-description">正在基于关键句子精确定位时间...</div>
                            </div>
                        </div>
                        <div class="processing-step" data-step="generate">
                            <div class="step-icon pending">4</div>
                            <div class="step-content">
                                <div class="step-title">生成笔记</div>
                                <div class="step-description">正在生成结构化笔记...</div>
                            </div>
                        </div>
                    </div>
                    
                    <p id="status-text">正在处理中，请耐心等待...</p>
                    <p class="processing-time" id="processing-time">已用时: 0秒</p>
                </div>
            </div>
            
            <!-- 视频播放和知识点区域 -->
            <div id="player-section" class="player-section" style="display: none;">
                <div class="player-container">
                    <!-- 左侧视频播放器 -->
                    <div class="video-panel">
                        <div class="video-header">
                            <h3 id="video-title-display">视频标题</h3>
                            <div class="video-controls">
                                <button id="fullscreen-btn" class="control-btn" title="全屏">⛶</button>
                            </div>
                        </div>
                        <div class="video-wrapper">
                            <video id="video-player" controls>
                                <source id="video-source" src="" type="video/mp4">
                                您的浏览器不支持视频播放。
                            </video>
                        </div>
                        <div class="video-info-bar">
                            <span id="current-time">00:00:00</span>
                            <span>/</span>
                            <span id="total-time">00:00:00</span>
                        </div>
                    </div>
                    
                   <!-- 右侧知识点面板 - 增强版本 -->
                    <div class="knowledge-panel">
                        <div class="panel-header">
                            <h3 id="panel-title">🎯 知识点标签</h3>
                                                    <div class="panel-controls">
                            <button id="auto-scroll-btn" class="control-btn active" title="自动滚动">📌</button>
                            <!-- 🆕 添加视图切换按钮 -->
                            <button id="view-toggle-btn" class="control-btn" title="切换到Summary视图">📚</button>
                            <button id="filter-btn" class="control-btn" title="筛选">🔍</button>
                        </div>
                        </div>
                        
                        <div class="knowledge-content">
                            <!-- 🆕 知识点列表视图 (默认显示) -->
                            <div id="knowledge-list-view" class="view-content">
                                <div id="knowledge-list" class="knowledge-list">
                                    <!-- 现有的知识点列表 -->
                                </div>
                                
                                <div id="knowledge-summary" class="knowledge-summary">
                                    <h4 id="summary-title">📋 内容摘要</h4>
                                    <div id="summary-content" class="summary-content">
                                        <!-- 现有的摘要内容 -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 🆕 Summary详细视图 (点击切换显示) -->
                            <div id="summary-detail-view" class="view-content" style="display: none;">
                                <div class="summary-header">
                                    <div class="summary-stats">
                                        <span>📊 <span id="concept-count-summary">0</span><span id="concept-count-text">个知识点</span></span>
                                        <span>⏱️ <span id="video-duration-summary">00:00</span></span>
                                        <span>🎯 <span id="difficulty-level">中等</span></span>
                                    </div>
                                </div>
                                
                                <div class="detailed-summary-content" id="detailed-summary-content">
                                    <!-- 详细Summary内容将在这里显示 -->
                                    <div class="empty-summary">
                                        <p id="empty-summary-text">📤 处理视频后将显示完整的课程Summary</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                <!-- 底部操作区域 -->
                <div class="bottom-actions">
                    <div class="action-buttons">
                        <button id="export-notes-btn" class="secondary-btn">📝 导出笔记</button>
                        <button id="export-timestamps-btn" class="secondary-btn">⏰ 导出时间戳</button>
                        <button id="share-btn" class="secondary-btn">📤 分享</button>
                    </div>
                </div>
            </div>
        </main>
        

            </div>
        </main>
        
        <!-- 🆕 AI对话区域 - 与页面宽度一致 -->
        <div class="ai-dialogue-section">
            <div class="dialogue-header">
                <h3>🤖 AI学习助手</h3>
                <div class="dialogue-controls">
                    <button id="toggle-dialogue-btn" class="control-btn" title="展开/收起对话框">💬</button>
                    <button id="clear-dialogue-btn" class="control-btn" title="清空对话">🗑️</button>
                </div>
            </div>
            
            <div class="dialogue-container" id="dialogue-container" style="display: none;">
                <div class="dialogue-messages" id="dialogue-messages">
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-header">
                                <span class="ai-avatar">🤖</span>
                                <span class="message-time" id="current-time-display">刚刚</span>
                            </div>
                            <div class="message-text">
                                你好！我是你的AI学习助手。我可以帮助你：
                                <br>• 解释视频中的知识点
                                <br>• 回答关于课程内容的问题
                                <br>• 提供学习建议和复习指导
                                <br><br>请告诉我你想了解什么？
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dialogue-input-area">
                    <div class="input-container">
                        <textarea 
                            id="dialogue-input" 
                            placeholder="输入你的问题或想法..." 
                            rows="3"
                            maxlength="500"
                        ></textarea>
                        <div class="input-actions">
                            <span class="char-count" id="char-count">0/500</span>
                            <button id="send-dialogue-btn" class="send-btn" disabled>发送</button>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="askQuestion('explain')">📚 解释知识点</button>
                        <button class="quick-btn" onclick="askQuestion('summary')">📋 总结要点</button>
                        <button class="quick-btn" onclick="askQuestion('practice')">🎯 生成练习</button>
                        <button class="quick-btn" onclick="askQuestion('review')">🔄 复习建议</button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="feature-info">
                <h3>✨ 功能特色</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>🎯 智能识别</h4>
                        <p>AI自动识别视频中的关键知识点</p>
                        <span class="feature-tag">AI驱动</span>
                    </div>
                    <div class="feature-card">
                        <h4>⏰ 精确时间戳</h4>
                        <p>精确定位知识点在视频中的时间位置</p>
                        <span class="feature-tag">精准定位</span>
                    </div>
                    <div class="feature-card">
                        <h4>🔄 实时同步</h4>
                        <p>视频播放时自动高亮当前知识点</p>
                        <span class="feature-tag">实时交互</span>
                    </div>
                    <div class="feature-card">
                        <h4>📱 响应式设计</h4>
                        <p>支持各种设备，移动端友好</p>
                        <span class="feature-tag">多端适配</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- 🆕 题目弹窗 -->
    <div id="question-dialogue-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3>🎯 智能学习助手</h3>
                <button class="close-btn" onclick="closeQuestionDialogue()">×</button>
            </div>
            
            <div class="modal-content">
                <!-- 左侧题目区域 -->
                <div class="question-panel">
                    <div class="question-header">
                        <div class="question-meta">
                            <span class="knowledge-point" id="question-knowledge-point">知识点: 概率论</span>
                            <span class="difficulty" id="question-difficulty">难度: 中等</span>
                            <span class="question-number" id="question-number">题号: #001</span>
                        </div>
                        <div class="question-controls">
                            <button class="control-btn" onclick="getHint()" title="获取提示">💡 提示</button>
                            <button class="control-btn" onclick="loadNextQuestion()" title="下一题">⏭️ 下一题</button>
                        </div>
                    </div>
                    
                    <div class="question-content">
                        <div id="question-text" class="question-text">
                            <!-- 题目内容将在这里显示 -->
                        </div>
                        
                        <div id="question-options" class="question-options">
                            <!-- 选项将在这里显示 -->
                        </div>
                        
                        <div class="answer-input-section">
                            <input type="text" id="answer-input" placeholder="请输入你的答案 (A/B/C/D/E)" class="answer-input">
                            <button id="submit-answer-btn" class="submit-btn">📤 提交答案</button>
                        </div>
                    </div>
                </div>
                
                <!-- 右侧对话窗口 -->
                <div class="dialogue-panel">
                    <div class="dialogue-header">
                        <h4>🤖 AI学习助手</h4>
                        <div class="dialogue-status" id="dialogue-status">准备开始学习...</div>
                    </div>
                    
                    <div class="dialogue-content">
                        <div id="dialogue-history" class="dialogue-history">
                            <!-- 对话历史将在这里显示 -->
                        </div>
                        
                        <div class="dialogue-actions">
                            <button id="finish-dialogue-btn" class="action-btn" style="display: none;">✅ 完成学习</button>
                            <button id="next-question-btn" class="action-btn" style="display: none;">⏭️ 下一题</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/script_video_player.js"></script>
</body>
</html> 